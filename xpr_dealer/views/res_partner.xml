<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE openerp SYSTEM "openerp.dtd">
<openerp>
  <data>
   
  <!-- partners -->
  <record id="view_partner_form" model="ir.ui.view">
      <field name="model">res.partner</field>
      <field name="inherit_id" ref="partner_history.view_partner_form_history"/>
      <field name="arch" type="xml">
        <xpath expr="//page[@string='Flat History']" position="attributes">
          <attribute name="string">Full History</attribute>
        </xpath>

        <field name="category_id" position="replace">
            <field name="code" placeholder="Code" attrs="{'invisible': [('is_company','=', False)], 'required' : [('is_company','=', True)]}"/>
           <!--  <label for="dealer" string="Is a Dealer" attrs="{'invisible': [('is_company','=', False)]}"/>
            <field name="dealer" widget="many2onebutton" readonly="True" attrs="{'invisible': [('is_company','=', False)]}" /> -->

            <field name="category_id" placeholder="Tags..." widget="many2many_tags" domain="['|', '|', '|', '|',('parent_id','child_of', %(category_dealer_group)d ), ('id','child_of', %(category_dealer_certification_automatic)d ), ('id','child_of', %(category_dealer_certification_manual)d ), ('id','child_of', %(category_dealer_marketing_association)d ), ('id','child_of', %(category_dealer_association)d )]"/>

        </field>

    </field>
  </record>

  <record id="dealer_search_view" model="ir.ui.view">
    <field name="name">dealer.search</field>
    <field name="model">xpr_dealer.dealer</field>
    <field name="arch" type="xml">
      <search string="Search Dealer">
         <field name="name" filter_domain="['|','|',('display_name','ilike',self),('ref','=',self),('email','ilike',self)]"/>
         <filter help="My Dealers" name="my_dealers" icon="terp-personal+" domain="[('user_id','=',uid)]"/>
         <filter help="Unassigned" name="unassigned" domain="[('assigned_user', '=', False)]" />
         <separator/>
         <field name="category_id" string="Tag" filter_domain="[('category_id','ilike', self)]"/>
         <field name="makes" string="Vehicle" filter_domain="[('makes.parent_id','ilike', self)]"/>
         <field name="makes" string="Makes" filter_domain="[('makes','ilike', self)]"/>
         <field name="code"/>
         <field name="state_id"/>
         <field name="city"/>
         <field name="business" string="Business" filter_domain="[('business','ilike', self)]"/>
         <field name="user_id"/>
         <group expand="0" string="Group By">
             <filter string="Salesperson" icon="terp-personal" domain="[]" context="{'group_by' : 'user_id'}"/>
             <filter string="State" icon="terp-personal" domain="[]" context="{'group_by' : 'state_id'}"/>
             <filter string="City" icon="terp-personal" domain="[]" context="{'group_by' : 'city'}"/>
         </group>
      </search>
    </field>
  </record>

  <record id="view_dealer_form" model="ir.ui.view">
      <field name="model">xpr_dealer.dealer</field>
      <field name="arch" type="xml">
        <form string="Dealer">
          <sheet>
            <h1><field name="name" readonly="1"/></h1> 
            <group>
        
                <group>
                  <field name="partner"/>
                  <field name="code" readonly="1"/>
                  <field name="category_id" placeholder="Tags..." widget="many2many_tags" domain="['|', '|', '|', '|',('parent_id','child_of', %(category_dealer_group)d ), ('id','child_of', %(category_dealer_certification_automatic)d ), ('id','child_of', %(category_dealer_certification_manual)d ), ('id','child_of', %(category_dealer_marketing_association)d ), ('id','child_of', %(category_dealer_association)d )]"/>
                  <field name="corpname"/>
                  <field name="responsible"/>
                  <field name="user_id" required="1"/>
                  <field name="quoteflag"/>
                </group>

                 <group>
                      <label for="street" string="Address"/>
                      <div>
                          <field name="street" placeholder="Street..."/>
                          <field name="street2"/>
                          <div class="address_format">
                              <field name="city" placeholder="City" style="width: 40%"/>
                              <field name="state_id" class="oe_no_button" placeholder="State" style="width: 37%" options="{&quot;no_open&quot;: True}" on_change="onchange_state(state_id)"/>
                              <field name="zip" placeholder="ZIP" style="width: 20%"/>
                          </div>
                          <field name="country_id" placeholder="Country" class="oe_no_button" options="{&quot;no_open&quot;: True, &quot;no_create&quot;: True}" />
                      </div>
                  </group>

                  <group>
                        <field name="phone" placeholder="e.g. +32.81.81.37.00"/>
                        <field name="mobile"/>
                        <field name="fax"/>
                        <field name="tollfree"/>
                        <field name="callsource_tollfree"/>
                        <field name="user_ids" invisible="1"/>
                        <field name="email" widget="email" attrs="{'required': [('user_ids','!=', [])]}"/>
                        <field name="title" options="{&quot;no_open&quot;: True}"/>
                  </group>

                <group>
                   <field name="website" widget="url" placeholder="e.g. www.odoo.com"/>
                   <field name="website_french" widget="url" placeholder="e.g. www.odoo.com"/>
                   <field name="additional_website" widget="url" placeholder="e.g. www.odoo.com"/>
                </group>
         
                <group>
                  <field name="billing_street"/>
                  <field name="billing_street2"/>
                  <field name="billing_city"/>
                  <field name="billing_zip"/>
                  <field name="billing_state_id"/>
                  <field name="billing_country_id"/>
                </group>
                <group>
                  <field name="geolat"/>
                  <field name="geolon"/>
                </group>
                <group>
                  <field name="makes" widget="many2many_tags"
                    domain="[('parent_id', 'child_of', %(category_dealer_industry)d)]"/>

                    <field name="business" widget="many2many_tags"
                    domain="[('parent_id', '=', %(category_dealer_business)d)]"/>

                    <field name="customer" widget="many2many_tags"
                    domain="[('parent_id', '=', %(category_dealer_customer)d)]"/>
                </group>

                <group>
                      <field name="user10"/>
                      <field name="user12"/>
                      <field name="user12e"/>
                      <field name="user40"/>
                      <field name="user40e"/>
                      <field name="user80"/>
                </group>
                <group>
                    <field name="telephone_choice"/>
                    <field name="site_type"/>
                    <field name="owner"/>
                    <field name="owneremail"/>
                </group>
                <group>
                    <field name="market"
                        domain="[('parent_id', 'child_of', %(category_dealer_market)d)]"/>
                    <field name="region" 
                        domain="[('parent_id', 'child_of', %(category_dealer_region)d)]"/>
                    <field name="portalmask" widget="many2many_tags"
                        domain="[('parent_id', 'child_of', %(category_dealer_portal)d)]"/>
                </group>
            
          </group>
          </sheet>
        </form>
      </field>
  </record>

  <record id="view_dealer_tree" model="ir.ui.view">
      <field name="model">xpr_dealer.dealer</field>
      <field name="type">tree</field>
      <field name="arch" type="xml">
        <tree>
          <field name="name" />
          <field name="code" />
          <field name="city" />
          <field name="state_id" />
        </tree>
      </field>
  </record>

  <record id="dealer_assign_wizard" model="ir.ui.view">
      <field name="name">xpr_dealer.dealer_assign_form</field>
      <field name="model">xpr_dealer.dealer_assign</field>
      <field name="arch" type="xml">
            <form string="Assign Dealers">
                <group>
                    <field name="dealers" readonly="1" invisible="1" />
                    <field name="salesperson" />
                </group>

                <footer>

                <button
                    string="Assign"
                    type="object"
                    name="assign"
                    class="oe_highlight"
                />
                <button
                    string="Cancel"
                    class="oe_link"
                    special="cancel" />
                </footer>
            </form>
    </field>
  </record>

  <record model="ir.actions.act_window" id="dealer_action">
      <field name="name">Dealers</field>
      <field name="res_model">xpr_dealer.dealer</field>
      <field name="view_mode">tree,form</field>
      <field name="context">{'search_default_my_dealers': 1}</field>
  </record>
  <menuitem id="dealer_menu" name="Dealers"
    parent="base.menu_sales"
    action="dealer_action"
    sequence="1"
    groups="base.group_sale_salesman"/>

  <act_window name="Assign Salesperson"
              res_model="xpr_dealer.dealer_assign"
              src_model="xpr_dealer.dealer"
              view_mode="form"
              multi="True"
              target="new"
              key2="client_action_multi"
              id="assign_dealer_action"
              groups="base.group_sale_manager"
              />

  </data>
</openerp>
